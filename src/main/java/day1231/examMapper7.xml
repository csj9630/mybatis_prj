<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="day1231">

<!--******** PL/SQL insert, update, delete, cursor ********
myBatis에서 procedure을 사용해보기.
-->
<select id="insertProc" parameterType="memberDTO" statementType="CALLABLE">
{ call insert_member(#{name,mode=IN,jdbcType=VARCHAR},
						#{age,mode=IN,jdbcType=NUMERIC},
						#{gender,mode=IN,jdbcType=VARCHAR},
						#{tel,mode=IN,jdbcType=VARCHAR},
						#{cnt,mode=OUT,jdbcType=NUMERIC},
						#{errMsg,mode=OUT,jdbcType=VARCHAR})}
</select>

<select id="updateProc" parameterType="memberDTO" statementType="CALLABLE">
{ call update_member(
		#{age,mode=IN,jdbcType=NUMERIC},
		#{tel,mode=IN,jdbcType=VARCHAR},
		#{num,mode=IN,jdbcType=NUMERIC},
		#{cnt,mode=OUT,jdbcType=NUMERIC},
		#{errMsg,mode=OUT,jdbcType=VARCHAR}
 	)
}

</select>

<!-- delete_member(i_num number, row_cnt out number,err_msg out varchar2)-->
<select id="deleteProc" parameterType="memberDTO" statementType="CALLABLE">
{ call delete_member(
		#{num,mode=IN,jdbcType=NUMERIC},
		#{cnt,mode=OUT,jdbcType=NUMERIC},
		#{errMsg,mode=OUT,jdbcType=VARCHAR}
 	)
}

</select>
<!--********select Procedure 사용*******
조회된 레코드를 저장할 resultMap 선언-->
  <!--(i_num number, cur out SYS_REFCURSOR)  -->
  
<resultMap type="hashmap" id="rowMap"/>
<select id="selectOneProc" statementType="CALLABLE">
{ call select_one_member(
		#{num,mode=IN,jdbcType=NUMERIC},
		#{searchMember,mode=OUT,jdbcType=CURSOR,javaType=java.sql.ResultSet,resultMap=rowMap}
 	)
}

</select>
<select id="selectAllProc" statementType="CALLABLE">
{ 
	call select_all_member(
		#{searchAllMember,
		mode=OUT,
		jdbcType=CURSOR,
		javaType=java.sql.ResultSet,
		resultMap=rowMap}
 	)
}

</select>
</mapper>

